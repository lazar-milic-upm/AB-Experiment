<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Survey</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>Quick Survey</h2>
  <form id="surveyForm">
    <div class="question-block">
      <p>How likely are you to click a button like this in real life?</p>
      <div class="radio-group">
        <label><input type="radio" name="likelihood" value="1" required> 1</label>
        <label><input type="radio" name="likelihood" value="2"> 2</label>
        <label><input type="radio" name="likelihood" value="3"> 3</label>
        <label><input type="radio" name="likelihood" value="4"> 4</label>
        <label><input type="radio" name="likelihood" value="5"> 5</label>
      </div>
    </div>
    <div class="question-block">
      <p>How visually appealing was the button?</p>
      <div class="radio-group">
        <label><input type="radio" name="appeal" value="1" required> 1</label>
        <label><input type="radio" name="appeal" value="2"> 2</label>
        <label><input type="radio" name="appeal" value="3"> 3</label>
        <label><input type="radio" name="appeal" value="4"> 4</label>
        <label><input type="radio" name="appeal" value="5"> 5</label>
      </div>
    </div>
    <button type="submit">Submit</button>
  </form>
  <script>
    const data = JSON.parse(localStorage.getItem("ab_click_data"));
    if (data) {
      const formattedTime = new Date(data.timestamp).toLocaleString();
      console.log("AB Test Click Data:");
      console.log("Version:", data.version);
      console.log("Timestamp:", formattedTime);
      console.log("Total Clicks on Page Before Button:", data.clickCount);
    }
    document.getElementById("surveyForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const likelihood = document.querySelector('input[name="likelihood"]:checked')?.value;
      const appeal = document.querySelector('input[name="appeal"]:checked')?.value;
      const payload = { ...data, likelihood: parseInt(likelihood), appeal: parseInt(appeal) };
      fetch("https://ab-experiment.onrender.com/submit", {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      }).then(res => {
        alert(`Thank you!\n\nYou rated:\n- Likelihood: ${likelihood}\n- Visual Appeal: ${appeal}\n\nYou'll now be redirected. ${payload}`);
        localStorage.removeItem("ab_click_data");
        setTimeout(() => window.location.href = "index.html", 1000);
      }).catch(() => alert("Error submitting your response."));
    });
  </script>
</body>
</html>
